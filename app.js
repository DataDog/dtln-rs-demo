(()=>{let e,t=[],n=[];const a=document.getElementById("rawAudio"),o=document.getElementById("denoisedAudio");o.autoplay=!1;const i=document.getElementById("btnStart"),d=document.getElementById("btnStop");document.getElementById("loadClip");let r=null,s=null,l=null,c=null,u=null,f=null;function m(e){e.data.size>0&&t.push(e.data)}function w(e){e.data.size>0&&n.push(e.data)}async function p(){a.src=URL.createObjectURL(new Blob(t,{type:"audio/webm"}));const e=new Blob(t,{type:"audio/webm"}),n=await e.arrayBuffer();l=await r.decodeAudioData(n),t=[],await async function(){const e=new OfflineAudioContext(l.numberOfChannels,l.length,l.sampleRate);await e.audioWorklet.addModule("/audio-worklet.js");const t=new AudioWorkletNode(e,"NoiseSuppressionWorker");t.port.onmessage=b;const n=e.createBufferSource();n.buffer=l,n.connect(t),t.connect(e.destination),n.start(),function(e){const t=function(e){const t=e.numberOfChannels,n=e.length*t*2+44,a=new ArrayBuffer(n),o=new DataView(a),i=[],d=e.sampleRate;let r=0,s=0;c(1179011410),c(n-8),c(1163280727),c(544501094),c(16),l(1),l(t),c(d),c(2*d*t),l(2*t),l(16),c(1635017060),c(n-r-4);for(let t=0;t<e.numberOfChannels;t++)i.push(e.getChannelData(t));for(;r<n;){for(let e=0;e<t;e++){const t=Math.max(-1,Math.min(1,i[e][s]));o.setInt16(r,t<0?32768*t:32767*t,!0),r+=2}s++}function l(e){o.setUint16(r,e,!0),r+=2}function c(e){o.setUint32(r,e,!0),r+=4}return a}(e),n=new Blob([t],{type:"audio/wav"});o.src=URL.createObjectURL(n),o.load()}(await e.startRendering())}()}function b(e){"ready"===e.data&&console.log("Worklet is ready..."),console.log(e.data)}i.addEventListener("click",(async function(){i.disabled=!0;try{await async function(){e=await navigator.mediaDevices.getUserMedia({audio:!0})}(),r||(r=new AudioContext({sampleRate:16e3})),s=r.createMediaStreamSource(e),s.channelCount=1,c=r.createMediaStreamDestination(),c.channelCount=1,f=new MediaRecorder(e),f.ondataavailable=m,u=new MediaRecorder(r.createMediaStreamDestination().stream),u.ondataavailable=w,f.onstop=p,console.log("Noise suppression module initialized. Starting worklet."),f.start(),i.disabled=!0,d.disabled=!1}catch(e){console.error("Error starting recording:",e)}})),d.addEventListener("click",(function(){e&&e.getTracks().forEach((e=>e.stop())),u&&"inactive"!==u.state&&(u.stop(),f.stop()),d.disabled=!0,i.disabled=!1}))})();